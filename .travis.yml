language: android
jdk: oraclejdk7
sudo: false

branches:
   only:
      - unstable

android:
   components:
      - build-tools-23.0.1
      - android-23
      - extra-google-m2repository
      - extra-android-m2repository

env:
   global:
      # install timeout in minutes
      - ADB_INSTALL_TIMEOUT=8
   matrix:
      - ANDROID_TARGET=android-19 ANDROID_ABI=armeabi-v7a
      - ANDROID_TARGET=android-20 ANDROID_ABI=armeabi-v7a
      - ANDROID_TARGET=android-21 ANDROID_ABI=armeabi-v7a
      - ANDROID_TARGET=android-22 ANDROID_ABI=armeabi-v7a
      - ANDROID_TARGET=android-23 ANDROID_ABI=armeabi-v7a

licenses:
    - android-sdk-license-5be876d5

# Create and start the emulator
before_script:
   - echo yes | android update sdk -a --no-ui --filter sys-img-armeabi-v7a-android-23
   - echo yes | android update sdk -a --no-ui --filter sys-img-armeabi-v7a-android-20
   - echo no | android create avd --force -n test -t $ANDROID_TARGET  --abi $ANDROID_ABI -c 128M
   - emulator -avd test -no-skin -no-audio -no-window &
   - android-wait-for-emulator
   - adb shell input keyevent 82
#Build all projects and run the tests
script:
   - travis_wait 30 ./gradlew :libs:SalesforceSDK:connectedAndroidTest
   - travis_wait 30 ./gradlew :libs:SmartStore:connectedAndroidTest
   - travis_wait 30 ./gradlew :libs:SmartSync:connectedAndroidTest
   - travis_wait 30 ./gradlew :libs:SalesforceHybrid:connectedAndroidTest
   - ./gradlew :libs:SalesforceReact:assembleDebug
   - travis_wait 30 ./gradlew :native:NativeSampleApps:RestExplorer:connectedAndroidTest
   - travis_wait 30 ./gradlew :native:TemplateApp:connectedAndroidTest
